{% extends "base.html" %}

{% block content %}
<div class="row mb-4 align-items-center">
    <div class="col-md-12">
        <h2 class="mb-0">
            <i class="fa-solid fa-chart-pie me-2"></i>Employee Group Analysis Report
        </h2>
        <p class="text-muted mt-2">
            This is the results of automated grouping via PCA and K-Means.
        </p>
    </div>
</div>

<!-- Section 1: Cluster Summary Card -->
<div class="card shadow-sm mb-4">
    <div class="card-header bg-white py-3">
        <h5 class="mb-0 text-primary">
            <i class="fa-solid fa-list-ol me-2"></i>Cluster Summary
        </h5>
    </div>
    <div class="card-body">
        <div class="alert alert-info border-0 bg-light">
            <i class="fa-solid fa-circle-info me-2"></i>
            <strong>Explanation: </strong> This table shows the average features of each group.
        </div>

        <div class="table-responsive">
            <table class="table table-bordered table-hover align-middle text-center">
                <thead class="table-light">
                    <tr>
                        <th>Cluster ID</th>
                        <th>Count</th>
                        <th>Average Age</th>
                        <th>Average Tenure</th>
                        <th>Average Salary</th>
                        <th>Average Bonus</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in summary_data %}
                    {% set row_class = '' %}
                    {% if row.Cluster_ID == 0 %}
                    {% set row_class = 'table-primary' %}
                    {% elif row.Cluster_ID == 1 %}
                    {% set row_class = 'table-success' %}
                    {% elif row.Cluster_ID == 2 %}
                    {% set row_class = 'table-warning' %}
                    {% else %}
                    {% set row_class = 'table-light' %}
                    {% endif %}

                    <tr>
                        <td class="fw-bold {{ row_class }}" style="--bs-table-bg-opacity: .2;">
                            {{ row.Cluster_ID }}
                        </td>
                        <td>{{ row.Count }}</td>
                        <td>{{ row.Age }} yrs</td>
                        <td>{{ row.Tenure }} yrs</td>
                        <td>${{ "{:,.0f}".format(row.BaseSalary) }}</td>
                        <td>${{ "{:,.0f}".format(row.Bonus) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Section 1.5: Insights Card -->
<div class="card shadow-sm mb-4">
    <div class="card-header bg-white py-3">
        <h5 class="mb-0 text-primary">
            <i class="fa-solid fa-lightbulb me-2"></i>Clustering Insights
        </h5>
    </div>
    <div class="card-body">
        <p class="text-muted mb-4">
            Based on the K-Means algorithm analysis of salary structures and tenure, the system has identified four
            distinct employee personas:
        </p>

        <div class="row g-3">
            <!-- Cluster 0: Blue (Interns/Temps) -->
            <div class="col-md-6 col-xl-3">
                <div class="alert alert-primary h-100 border-0 shadow-sm">
                    <h5 class="alert-heading fw-bold">
                        <i class="fa-solid fa-id-badge me-2"></i>Cluster 0
                    </h5>
                    <hr>
                    <h6 class="fw-bold">Interns & Contingent Staff</h6>
                    <ul class="small mb-0 ps-3">
                        <li><strong>Profile:</strong> Lowest base salary with significantly low bonuses ($2.5k).</li>
                        <li><strong>Tenure:</strong> Least experienced (Avg 2.7 years).</li>
                        <li><strong>Insight:</strong> Likely short-term or non-core staff. This group typically carries
                            a higher turnover risk.</li>
                    </ul>
                </div>
            </div>

            <!-- Cluster 1: Green (Specialists) -->
            <div class="col-md-6 col-xl-3">
                <div class="alert alert-success h-100 border-0 shadow-sm">
                    <h5 class="alert-heading fw-bold">
                        <i class="fa-solid fa-briefcase me-2"></i>Cluster 1
                    </h5>
                    <hr>
                    <h6 class="fw-bold">Mid-Level Specialists</h6>
                    <ul class="small mb-0 ps-3">
                        <li><strong>Profile:</strong> Mid-High salary ($56k) with healthy bonuses.</li>
                        <li><strong>Tenure:</strong> Solid experience (Avg 7.3 years).</li>
                        <li><strong>Insight:</strong> Smallest group (3 people). Likely specialized experts or team
                            leads bridging the gap between juniors and management.</li>
                    </ul>
                </div>
            </div>

            <!-- Cluster 2: Yellow (Seniors) -->
            <div class="col-md-6 col-xl-3">
                <div class="alert alert-warning h-100 border-0 shadow-sm">
                    <h5 class="alert-heading fw-bold">
                        <i class="fa-solid fa-crown me-2"></i>Cluster 2
                    </h5>
                    <hr>
                    <h6 class="fw-bold">Senior Core & Leadership</h6>
                    <ul class="small mb-0 ps-3">
                        <li><strong>Profile:</strong> Highest salary ($71k) and highest bonuses.</li>
                        <li><strong>Tenure:</strong> Highly senior (Avg 12.4 years).</li>
                        <li><strong>Insight:</strong> Largest group (23 people). Indicates a stable core workforce or a
                            potentially top-heavy organizational structure.</li>
                    </ul>
                </div>
            </div>

            <!-- Cluster 3: Gray (Juniors) -->
            <div class="col-md-6 col-xl-3">
                <div class="alert bg-light border h-100 shadow-sm">
                    <h5 class="alert-heading fw-bold text-dark">
                        <i class="fa-solid fa-user me-2"></i>Cluster 3
                    </h5>
                    <hr>
                    <h6 class="fw-bold">Junior Associates</h6>
                    <ul class="small mb-0 ps-3">
                        <li><strong>Profile:</strong> Low-Mid salary ($40k) but receiving standard bonuses.</li>
                        <li><strong>Tenure:</strong> Young professionals (Avg 3.5 years).</li>
                        <li><strong>Insight:</strong> The operational engine. Distinct from Cluster 0 due to permanent
                            staff benefits structure.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Section 2: PREDICTIVE ANALYTICS -->
<div class="card shadow-sm mb-4">
    <div class="card-header bg-white py-3">
        <h5 class="mb-0 text-primary">
            <i class="fa-solid fa-brain me-2"></i>Predictive Analytics
        </h5>
    </div>
    <div class="card-body">
        <p class="text-muted mb-4">
            Machine learning predictions for employee turnover risk and salary alignment based on historical data
            patterns.
        </p>

        <div class="row g-4 mb-4">
            <!-- Turnover Risk Distribution -->
            <div class="col-md-6">
                <div class="card border-0 bg-light h-100">
                    <div class="card-body">
                        <h6 class="card-title fw-bold mb-3">
                            <i class="fa-solid fa-exclamation-triangle me-2 text-warning"></i>Turnover Risk Distribution
                        </h6>
                        <div class="table-responsive">
                            <table class="table table-sm table-borderless">
                                <tbody>
                                    {% for item in prediction_data.turnover_summary %}
                                    {% set risk_class = '' %}
                                    {% set risk_icon = '' %}
                                    {% if item.Risk_Level == 'High' %}
                                    {% set risk_class = 'text-danger' %}
                                    {% set risk_icon = 'fa-circle-xmark' %}
                                    {% elif item.Risk_Level == 'Medium' %}
                                    {% set risk_class = 'text-warning' %}
                                    {% set risk_icon = 'fa-circle-exclamation' %}
                                    {% else %}
                                    {% set risk_class = 'text-success' %}
                                    {% set risk_icon = 'fa-circle-check' %}
                                    {% endif %}
                                    <tr>
                                        <td class="fw-bold {{ risk_class }}">
                                            <i class="fa-solid {{ risk_icon }} me-2"></i>{{ item.Risk_Level }} Risk
                                        </td>
                                        <td class="text-end">{{ item.Count }} employees ({{ item.Percentage }}%)</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Salary Alignment Distribution -->
            <div class="col-md-6">
                <div class="card border-0 bg-light h-100">
                    <div class="card-body">
                        <h6 class="card-title fw-bold mb-3">
                            <i class="fa-solid fa-dollar-sign me-2 text-success"></i>Salary Alignment Distribution
                        </h6>
                        <div class="table-responsive">
                            <table class="table table-sm table-borderless">
                                <tbody>
                                    {% for item in prediction_data.salary_summary %}
                                    {% set align_class = '' %}
                                    {% set align_icon = '' %}
                                    {% if item.Alignment == 'Above Market' %}
                                    {% set align_class = 'text-info' %}
                                    {% set align_icon = 'fa-arrow-up' %}
                                    {% elif item.Alignment == 'Below Market' %}
                                    {% set align_class = 'text-danger' %}
                                    {% set align_icon = 'fa-arrow-down' %}
                                    {% else %}
                                    {% set align_class = 'text-success' %}
                                    {% set align_icon = 'fa-equals' %}
                                    {% endif %}
                                    <tr>
                                        <td class="fw-bold {{ align_class }}">
                                            <i class="fa-solid {{ align_icon }} me-2"></i>{{ item.Alignment }}
                                        </td>
                                        <td class="text-end">{{ item.Count }} employees ({{ item.Percentage }}%)</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Model Performance Metrics -->
        <div class="alert alert-secondary border-0">
            <h6 class="fw-bold mb-2"><i class="fa-solid fa-chart-line me-2"></i>Model Performance</h6>
            <div class="row text-center">
                <div class="col-md-4">
                    <small class="text-muted d-block">Turnover Prediction Accuracy</small>
                    <strong class="fs-5 text-primary">{{ prediction_data.model_metrics.turnover_accuracy }}%</strong>
                </div>
                <div class="col-md-4">
                    <small class="text-muted d-block">Salary Prediction RÂ² Score</small>
                    <strong class="fs-5 text-success">{{ prediction_data.model_metrics.salary_r2 }}</strong>
                </div>
                <div class="col-md-4">
                    <small class="text-muted d-block">Salary MAE</small>
                    <strong class="fs-5 text-info">${{ "{:,.0f}".format(prediction_data.model_metrics.salary_mae)
                        }}</strong>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Section 2.5: Detailed Employee Classification List -->
<div class="card shadow-sm mb-4">
    <div class="card-header bg-white py-3">
        <h5 class="mb-0 text-primary">
            <i class="fa-solid fa-users me-2"></i>Detailed Employee Classification List
        </h5>
    </div>
    <div class="card-body">
        <p class="text-muted mb-4">
            Click to expand and view specific employees under each risk level and salary alignment category.
        </p>

        <!-- Turnover Risk Classification -->
        <h6 class="fw-bold mb-3">
            <i class="fa-solid fa-exclamation-triangle me-2 text-warning"></i>By Turnover Risk
        </h6>

        <div class="accordion mb-4" id="turnoverRiskAccordion">
            <!-- High Risk -->
            <div class="accordion-item border-danger">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed bg-danger bg-opacity-10" type="button"
                        data-bs-toggle="collapse" data-bs-target="#highRisk">
                        <i class="fa-solid fa-circle-xmark text-danger me-2"></i>
                        <strong>High Risk</strong>
                        <span class="badge bg-danger ms-2">
                            {{ prediction_data.details | selectattr('TurnoverRisk', 'equalto', 'High') | list | length
                            }} Employees
                        </span>
                    </button>
                </h2>
                <div id="highRisk" class="accordion-collapse collapse" data-bs-parent="#turnoverRiskAccordion">
                    <div class="accordion-body">
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead class="table-light">
                                    <tr>
                                        <th>Employee ID</th>
                                        <th>Name</th>
                                        <th>Department</th>
                                        <th>Job Title</th>
                                        <th>Tenure</th>
                                        <th>Salary</th>
                                        <th>Risk Probability</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for emp in prediction_data.details %}
                                    {% if emp.TurnoverRisk == 'High' %}
                                    <tr>
                                        <td>{{ emp.EmployeeID }}</td>
                                        <td>{{ emp.FirstName }} {{ emp.LastName }}</td>
                                        <td>{{ emp.DepartmentName }}</td>
                                        <td>{{ emp.JobTitle }}</td>
                                        <td>{{ emp.Tenure }} yrs</td>
                                        <td>${{ "{:,.0f}".format(emp.BaseSalary) }}</td>
                                        <td><span class="badge bg-danger">{{
                                                "{:.1f}".format(emp.TurnoverRisk_Probability) }}%</span></td>
                                    </tr>
                                    {% endif %}
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Medium Risk -->
            <div class="accordion-item border-warning">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed bg-warning bg-opacity-10" type="button"
                        data-bs-toggle="collapse" data-bs-target="#mediumRisk">
                        <i class="fa-solid fa-circle-exclamation text-warning me-2"></i>
                        <strong>Medium Risk</strong>
                        <span class="badge bg-warning ms-2">
                            {{ prediction_data.details | selectattr('TurnoverRisk', 'equalto', 'Medium') | list | length
                            }} Employees
                        </span>
                    </button>
                </h2>
                <div id="mediumRisk" class="accordion-collapse collapse" data-bs-parent="#turnoverRiskAccordion">
                    <div class="accordion-body">
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead class="table-light">
                                    <tr>
                                        <th>Employee ID</th>
                                        <th>Name</th>
                                        <th>Department</th>
                                        <th>Job Title</th>
                                        <th>Tenure</th>
                                        <th>Salary</th>
                                        <th>Risk Probability</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for emp in prediction_data.details %}
                                    {% if emp.TurnoverRisk == 'Medium' %}
                                    <tr>
                                        <td>{{ emp.EmployeeID }}</td>
                                        <td>{{ emp.FirstName }} {{ emp.LastName }}</td>
                                        <td>{{ emp.DepartmentName }}</td>
                                        <td>{{ emp.JobTitle }}</td>
                                        <td>{{ emp.Tenure }} yrs</td>
                                        <td>${{ "{:,.0f}".format(emp.BaseSalary) }}</td>
                                        <td><span class="badge bg-warning">{{
                                                "{:.1f}".format(emp.TurnoverRisk_Probability) }}%</span></td>
                                    </tr>
                                    {% endif %}
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Low Risk -->
            <div class="accordion-item border-success">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed bg-success bg-opacity-10" type="button"
                        data-bs-toggle="collapse" data-bs-target="#lowRisk">
                        <i class="fa-solid fa-circle-check text-success me-2"></i>
                        <strong>Low Risk</strong>
                        <span class="badge bg-success ms-2">
                            {{ prediction_data.details | selectattr('TurnoverRisk', 'equalto', 'Low') | list | length }}
                            Employees
                        </span>
                    </button>
                </h2>
                <div id="lowRisk" class="accordion-collapse collapse" data-bs-parent="#turnoverRiskAccordion">
                    <div class="accordion-body">
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead class="table-light">
                                    <tr>
                                        <th>Employee ID</th>
                                        <th>Name</th>
                                        <th>Department</th>
                                        <th>Job Title</th>
                                        <th>Tenure</th>
                                        <th>Salary</th>
                                        <th>Risk Probability</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for emp in prediction_data.details %}
                                    {% if emp.TurnoverRisk == 'Low' %}
                                    <tr>
                                        <td>{{ emp.EmployeeID }}</td>
                                        <td>{{ emp.FirstName }} {{ emp.LastName }}</td>
                                        <td>{{ emp.DepartmentName }}</td>
                                        <td>{{ emp.JobTitle }}</td>
                                        <td>{{ emp.Tenure }} yrs</td>
                                        <td>${{ "{:,.0f}".format(emp.BaseSalary) }}</td>
                                        <td><span class="badge bg-success">{{
                                                "{:.1f}".format(emp.TurnoverRisk_Probability) }}%</span></td>
                                    </tr>
                                    {% endif %}
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Salary Alignment Classification -->
        <h6 class="fw-bold mb-3 mt-4">
            <i class="fa-solid fa-dollar-sign me-2 text-success"></i>By Salary Alignment
        </h6>

        <div class="accordion" id="salaryAlignmentAccordion">
            <!-- Below Market -->
            <div class="accordion-item border-danger">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed bg-danger bg-opacity-10" type="button"
                        data-bs-toggle="collapse" data-bs-target="#belowMarket">
                        <i class="fa-solid fa-arrow-down text-danger me-2"></i>
                        <strong>Below Market</strong>
                        <span class="badge bg-danger ms-2">
                            {{ prediction_data.details | selectattr('SalaryAlignment', 'equalto', 'Below Market') | list
                            | length }} Employees
                        </span>
                    </button>
                </h2>
                <div id="belowMarket" class="accordion-collapse collapse" data-bs-parent="#salaryAlignmentAccordion">
                    <div class="accordion-body">
                        <div class="alert alert-warning border-0">
                            <i class="fa-solid fa-lightbulb me-2"></i>
                            <strong>Suggestion:</strong> These employees' salaries are more than 10% below the predicted
                            value. Consider salary adjustments to reduce turnover risk.
                        </div>
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead class="table-light">
                                    <tr>
                                        <th>Employee ID</th>
                                        <th>Name</th>
                                        <th>Department</th>
                                        <th>Job Title</th>
                                        <th>Actual Salary</th>
                                        <th>Predicted Salary</th>
                                        <th>Difference</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for emp in prediction_data.details %}
                                    {% if emp.SalaryAlignment == 'Below Market' %}
                                    <tr>
                                        <td>{{ emp.EmployeeID }}</td>
                                        <td>{{ emp.FirstName }} {{ emp.LastName }}</td>
                                        <td>{{ emp.DepartmentName }}</td>
                                        <td>{{ emp.JobTitle }}</td>
                                        <td>${{ "{:,.0f}".format(emp.BaseSalary) }}</td>
                                        <td>${{ "{:,.0f}".format(emp.PredictedSalary) }}</td>
                                        <td><span class="badge bg-danger">{{ "{:.1f}".format(emp.SalaryDifference_Pct)
                                                }}%</span></td>
                                    </tr>
                                    {% endif %}
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Market Aligned -->
            <div class="accordion-item border-success">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed bg-success bg-opacity-10" type="button"
                        data-bs-toggle="collapse" data-bs-target="#marketAligned">
                        <i class="fa-solid fa-equals text-success me-2"></i>
                        <strong>Market Aligned</strong>
                        <span class="badge bg-success ms-2">
                            {{ prediction_data.details | selectattr('SalaryAlignment', 'equalto', 'Market Aligned') |
                            list | length }} Employees
                        </span>
                    </button>
                </h2>
                <div id="marketAligned" class="accordion-collapse collapse" data-bs-parent="#salaryAlignmentAccordion">
                    <div class="accordion-body">
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead class="table-light">
                                    <tr>
                                        <th>Employee ID</th>
                                        <th>Name</th>
                                        <th>Department</th>
                                        <th>Job Title</th>
                                        <th>Actual Salary</th>
                                        <th>Predicted Salary</th>
                                        <th>Difference</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for emp in prediction_data.details %}
                                    {% if emp.SalaryAlignment == 'Market Aligned' %}
                                    <tr>
                                        <td>{{ emp.EmployeeID }}</td>
                                        <td>{{ emp.FirstName }} {{ emp.LastName }}</td>
                                        <td>{{ emp.DepartmentName }}</td>
                                        <td>{{ emp.JobTitle }}</td>
                                        <td>${{ "{:,.0f}".format(emp.BaseSalary) }}</td>
                                        <td>${{ "{:,.0f}".format(emp.PredictedSalary) }}</td>
                                        <td><span class="badge bg-success">{{ "{:.1f}".format(emp.SalaryDifference_Pct)
                                                }}%</span></td>
                                    </tr>
                                    {% endif %}
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Above Market -->
            <div class="accordion-item border-info">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed bg-info bg-opacity-10" type="button"
                        data-bs-toggle="collapse" data-bs-target="#aboveMarket">
                        <i class="fa-solid fa-arrow-up text-info me-2"></i>
                        <strong>Above Market</strong>
                        <span class="badge bg-info ms-2">
                            {{ prediction_data.details | selectattr('SalaryAlignment', 'equalto', 'Above Market') | list
                            | length }} Employees
                        </span>
                    </button>
                </h2>
                <div id="aboveMarket" class="accordion-collapse collapse" data-bs-parent="#salaryAlignmentAccordion">
                    <div class="accordion-body">
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead class="table-light">
                                    <tr>
                                        <th>Employee ID</th>
                                        <th>Name</th>
                                        <th>Department</th>
                                        <th>Job Title</th>
                                        <th>Actual Salary</th>
                                        <th>Predicted Salary</th>
                                        <th>Difference</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for emp in prediction_data.details %}
                                    {% if emp.SalaryAlignment == 'Above Market' %}
                                    <tr>
                                        <td>{{ emp.EmployeeID }}</td>
                                        <td>{{ emp.FirstName }} {{ emp.LastName }}</td>
                                        <td>{{ emp.DepartmentName }}</td>
                                        <td>{{ emp.JobTitle }}</td>
                                        <td>${{ "{:,.0f}".format(emp.BaseSalary) }}</td>
                                        <td>${{ "{:,.0f}".format(emp.PredictedSalary) }}</td>
                                        <td><span class="badge bg-info">+{{ "{:.1f}".format(emp.SalaryDifference_Pct)
                                                }}%</span></td>
                                    </tr>
                                    {% endif %}
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Section 3: Detailed List Card -->
<div class="card shadow-sm">
    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
        <h5 class="mb-0 text-primary">
            <i class="fa-solid fa-users-viewfinder me-2"></i>Detailed Employee Group List
        </h5>
        <!-- Download Button Moved Here -->
        <a href="/download_analysis" class="btn btn-sm btn-success">
            <i class="fa-solid fa-file-csv me-2"></i>Export Results (CSV)
        </a>
    </div>
    <div class="card-body">
        <p class="text-muted mb-3">
            Displays each employee's data, sorted by<strong> Cluster ID (0-3)</strong>.
        </p>

        <div class="table-responsive">
            <table class="table table-hover table-bordered align-middle">
                <thead class="table-light text-center">
                    <tr>
                        <th>Cluster ID</th>
                        <th>Employee ID</th>
                        <th>Name</th>
                        <th>Department</th>
                        <th>Job Title</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in details_data %}
                    {% set row_class = '' %}
                    {% if row.Cluster_ID == 0 %}
                    {% set row_class = 'table-primary' %}
                    {% elif row.Cluster_ID == 1 %}
                    {% set row_class = 'table-success' %}
                    {% elif row.Cluster_ID == 2 %}
                    {% set row_class = 'table-warning' %}
                    {% else %}
                    {% set row_class = 'table-light' %}
                    {% endif %}

                    <tr class="text-center">
                        <td class="fw-bold {{ row_class }}" style="--bs-table-bg-opacity: .2;">
                            {{ row.Cluster_ID }}
                        </td>
                        <td>{{ row.EmployeeID }}</td>
                        <td>{{ row.FirstName }} {{ row.LastName }}</td>
                        <td>{{ row.DepartmentName }}</td>
                        <td>{{ row.JobTitle }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}